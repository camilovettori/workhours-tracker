AVATARS_DIR = STATIC_DIR / "avatars"
AVATARS_DIR.mkdir(parents=True, exist_ok=True)

# ==== avatar_path migration (add column if missing) ====
def ensure_avatar_path_column(conn: sqlite3.Connection) -> None:
    cols = [r["name"] for r in conn.execute("PRAGMA table_info(users)").fetchall()]
    if "avatar_path" not in cols:
        conn.execute("ALTER TABLE users ADD COLUMN avatar_path TEXT")
        conn.commit()

# call it inside init_db() after CREATE TABLE users...
with db() as conn:
    ensure_avatar_path_column(conn)
